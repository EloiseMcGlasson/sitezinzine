{% extends 'base.html.twig' %}

{% block title %}Réinitialiser le mot de passe{% endblock %}

{% block body %}
<style>
  .reset-wrap{
    background: linear-gradient(#E4013A, #B81C61);
    min-height: 100vh;
    min-height: 100svh;
    padding: 24px 0;
    font-family: "Montserrat Alternates", sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .reset-card{
    width: min(420px, calc(100% - 24px));
    margin: 0 auto;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,.12);
    padding: 1.5rem;
    color: #1C1C1A;
  }

  .reset-card h1{
    margin: 0 0 14px 0;
    text-align: center;
    color: #E4013A;
    font-weight: 900;
    font-size: 22px;
    overflow-wrap: anywhere;
  }

  .flash{
    margin: 10px 0;
    padding: 10px;
    border-radius: 8px;
    background: #ffe6e6;
    border: 1px solid #ffcccc;
    color: #a10000;
    overflow-wrap: anywhere;
  }

  .success{
    background: #e6ffef;
    border-color: #b8f5cd;
    color: #0c6b2f;
  }

  .reset-card label{
    display:block;
    margin: 12px 0 6px;
    font-weight: 800;
    color:#333;
  }

  .reset-card input{
    width: 100%;
    padding: .8rem;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 16px;
    box-sizing: border-box;
  }

  .btn{
    width: 100%;
    padding: .8rem;
    border: 0;
    border-radius: 26px;
    background: #E4013A;
    color: #fff;
    font-weight: 900;
    cursor: pointer;
    margin-top: 14px;
    font-size: 16px;
  }

  .btn:hover{ background:#b30021; }

  /* ====== Password toggle ====== */
  .password-field{
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .password-field input{
    flex: 1;
    min-width: 0;
  }

  .toggle-password{
    flex: 0 0 auto;
    padding: 0.65rem 0.9rem;
    border-radius: 8px;
    border: 1px solid #ddd;
    background: #fff;
    color: #E4013A;
    font-family: "Montserrat Alternates", sans-serif;
    font-weight: 800;
    cursor: pointer;
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    white-space: nowrap;
  }

  .toggle-password:hover{
    background: #E4013A;
    color: #fff;
    border-color: #E4013A;
  }

  /* ✅ Mobile */
  @media (max-width: 480px){
    .reset-wrap{
      padding: 16px 0;
      align-items: flex-start;
    }

    .reset-card{
      margin-top: 16px;
      padding: 1.1rem;
      border-radius: 12px;
    }

    .reset-card h1{
      font-size: 20px;
      margin-bottom: 12px;
    }

    .btn{
      border-radius: 22px;
    }
  }

  @media (max-width: 420px){
    .password-field{ flex-direction: column; align-items: stretch; }
    .toggle-password{ width: 100%; }
  }
</style>

<div class="reset-wrap">
  <div class="reset-card">
    <h1>Nouveau mot de passe</h1>

    {% for msg in app.flashes('error') %}
      <div class="flash">{{ msg }}</div>
    {% endfor %}

    {% for msg in app.flashes('success') %}
      <div class="flash success">{{ msg }}</div>
    {% endfor %}

    {{ form_start(resetForm, { attr: { 'data-turbo': 'false' } }) }}

      {# Champ mot de passe #}
      <label for="reset_password">Mot de passe</label>
      <div class="password-field">
        {{ form_widget(resetForm.password, { attr: { id: 'reset_password' } }) }}
        <button
          type="button"
          class="toggle-password"
          id="toggleResetPassword"
          aria-controls="reset_password reset_password_confirm"
          aria-pressed="false"
        >
          Afficher
        </button>
      </div>
      {{ form_errors(resetForm.password) }}

      {# Champ confirmation #}
      <label for="reset_password_confirm">Confirmer le mot de passe</label>
      <div class="password-field">
        {{ form_widget(resetForm.passwordConfirm, { attr: { id: 'reset_password_confirm' } }) }}
      </div>
      {{ form_errors(resetForm.passwordConfirm) }}

      <button class="btn" type="submit">Changer le mot de passe</button>

    {{ form_end(resetForm) }}
  </div>
</div>

<script>
  (function () {
    function bindResetToggle() {
      const btn = document.getElementById('toggleResetPassword');
      if (!btn) return;

      // On récupère les 2 champs de manière robuste (id forcé OU fallback)
      const input1 =
        document.getElementById('reset_password') ||
        document.querySelector('input[name$="[password]"]');

      const input2 =
        document.getElementById('reset_password_confirm') ||
        document.querySelector('input[name$="[passwordConfirm]"], input[name$="[password_confirm]"]');

      if (!input1 || !input2) return;

      // Évite de binder plusieurs fois si Turbo recharge
      if (btn.dataset.bound === '1') return;
      btn.dataset.bound = '1';

      btn.addEventListener('click', () => {
        const isPassword = input1.type === 'password';
        const newType = isPassword ? 'text' : 'password';

        input1.type = newType;
        input2.type = newType;

        btn.textContent = isPassword ? 'Masquer' : 'Afficher';
        btn.setAttribute('aria-pressed', isPassword ? 'true' : 'false');
      });
    }

    // Chargement classique
    document.addEventListener('DOMContentLoaded', bindResetToggle);
    // Chargement Turbo
    document.addEventListener('turbo:load', bindResetToggle);
  })();
</script>

{% endblock %}
