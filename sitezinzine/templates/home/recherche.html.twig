{% extends 'base.html.twig' %}
{% block title %}
  Recherche d'émissions
{% endblock %}
{% block body %}
  <style>
.recherche,
.results{
  overflow-x: clip;
}


  /* box-sizing appliqué au bloc formulaire */
  .recherche, .recherche * { box-sizing: border-box; }

  /* Les cellules flex doivent pouvoir rétrécir */
  .search-row > div,
  .date-range > div { min-width: 0; }

  .recherche{
    background: linear-gradient(#E4013A, #B81C61);
    background-size: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    font-family: "Montserrat Alternates", sans-serif;
    font-weight: 500;
    font-style: normal;
  }

  .recherche strong{ font-weight: 700 !important; }
  .recherche em{ font-style: italic !important; }

  .recherche h1{
    color: white;
    font-family: "Montserrat Alternates", sans-serif;
    font-weight: 900;
    text-align: center;
    font-size: 36pt;
    margin-bottom: 10px;
  }

  .form{
    padding: 10px;
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
  }

  .search-row{
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
  }
  .search-row > div{ flex: 1; }

  .form label{
    color: white;
    font-family: "Montserrat Alternates", sans-serif;
    font-weight: normal;
    font-size: 16pt;
    margin-bottom: 15px;
  }

  /* Champs (y compris flatpickr) */
  .form input[type="text"],
  .form select,
  .form input[type="datetime-local"],
  .form input.flatpickr-input{
    width: 100%;
    max-width: 100%;
    padding: 12px 20px;
    margin: 8px 0;
    display: block;
    border: 1px solid #ccc;
    border-radius: 4px;
    background: #fff;
    box-sizing: border-box;
  }

  .date-range{
    display: flex;
    gap: 20px;
    margin: 15px 0;
  }
  .date-range > div{ flex: 1; }

  .button-group{
    display: flex;
    gap: 20px;
    margin: 20px 0;
  }

  button[type=submit],
  button[type=reset]{
    flex: 1;
    background-color: white;
    color: #E4013A;
    padding: 14px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-family: "Montserrat Alternates", sans-serif;
    font-weight: bold;
    font-size: 16pt;
    transition: all 0.3s ease;
  }

  button[type=reset]{
    background-color: transparent;
    border: 2px solid white;
    color: white;
  }

  button[type=submit]:hover,
  button[type=reset]:hover{
    background-color: #E4013A;
    color: white;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  button[type=reset]:hover{
    background-color: white;
    color: #E4013A;
  }

  

  /* Responsive FORMULAIRE */
  @media (max-width: 768px){
    .recherche{ padding-right: 0; padding-left: 0; }

    .form{ padding: 10px 12px; }
.imgbottom{
    margin-bottom: -1px;
    width: 100%;
  }
    .recherche h1{
      font-size: 28px;
      line-height: 1.1;
      margin-bottom: 12px;
    }

    .search-row,
    .date-range,
    .button-group{
      flex-direction: column;
      gap: 12px;
    }

    button[type=submit],
    button[type=reset]{
      width: 100%;
      flex: unset;
    }
  }
</style>
  <div class="recherche">
    <h1>
      Recherche d'émissions
    </h1>
    <div class="form" data-controller="reset-form" data-reset-form-url-value="{{ path('emission.recherche') }}">
      {{ form_start(form, { attr: { 'data-reset-form-target': 'form' } }) }}
      <div class="search-row">
        <div>
          {{ form_row(form.titre) }}
        </div>
        <div>
          {{ form_row(form.categorie) }}
        </div>
        <div>
          {{ form_row(form.theme) }}
        </div>
      </div>
      <div class="date-range">
        {{ form_row(form.dateDebut, { attr: { 'data-controller': 'flatpickr' } }) }}
        {{ form_row(form.dateFin,   { attr: { 'data-controller': 'flatpickr' } }) }}
      </div>
      <div class="button-group">
        <button type="submit">
          Rechercher
        </button>
        <button type="reset" data-action="reset-form#reset">
          Réinitialiser
        </button>
      </div>
      {{ form_end(form) }}
    </div>
    <img class="imgbottom" src="/images/top-content-dechire-D.gif" alt=""></div>
    {# ✅ Tout ce qui concerne l'affichage des émissions est externalisé #}
    {% include 'partials/_emission_results.html.twig' with {
      emissions: emissions,
      searchTerm: searchTerm,
      showNoResults: form.vars.submitted,
      resultsTitle: 'Résultats de la recherche :',
      noResultsText: 'Aucune émission trouvée pour les critères de recherche.'
    } %}
    <script>
  window.addEventListener('load', () => {
    const docW = document.documentElement.clientWidth;
    const offenders = [...document.querySelectorAll('*')].filter(el => el.scrollWidth > docW);
    console.log("Viewport:", docW);
    console.log("Offenders:", offenders.map(el => ({
      tag: el.tagName,
      class: el.className,
      id: el.id,
      scrollWidth: el.scrollWidth
    })));
    offenders.forEach(el => el.style.outline = '3px solid lime');
  });
</script>
  {% endblock %}
  