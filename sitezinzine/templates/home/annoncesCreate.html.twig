{% extends 'base.html.twig' %}

{% block title %}Créer une annonce{% endblock %}

{% block body %}
<style>
  .annonce-form-page,
  .annonce-form-page *{ box-sizing: border-box; }

  .annonce-form-page{
    width: 100%;
    padding: 28px 16px 48px;
    font-family: "Montserrat Alternates", sans-serif;
    color: #fff;
  }

  .annonce-form-card{
    width: 100%;
    max-width: 980px;
    margin: 0 auto;
    background: rgba(249,249,249,0.98);
    color: #1C1C1A;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    overflow: hidden;
  }

  .annonce-form-header{
    padding: 22px 20px 12px;
    text-align: center;
  }

  .annonce-form-title{
    margin: 0;
    font-weight: 900;
    font-size: clamp(20px, 4vw, 34px);
    color: #333;
    line-height: 1.15;
  }

  .annonce-form-body{
    padding: 18px 20px 22px;
  }

  .form-grid{
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px 16px;
  }

  .form-grid--1{ grid-template-columns: 1fr; }
  .form-grid--dates{ grid-template-columns: 1fr 1fr; }

  .form-block{ margin-top: 14px; }

  .annonce-form-page label{
    display: inline-block;
    margin-bottom: 6px;
    font-weight: 700;
    color: #333;
    font-size: 0.95rem;
  }

  .annonce-form-page input,
  .annonce-form-page select,
  .annonce-form-page textarea{
    width: 100%;
    padding: 12px 12px;
    border: 1px solid #ccc;
    border-radius: 8px;
    background: #fff;
    color: #1C1C1A;
    font-family: "Montserrat", sans-serif;
    font-size: 1rem;
    line-height: 1.2;
  }

  .annonce-form-page textarea{ min-height: 160px; }

  .field-limit{
    margin-top: 6px;
    font-size: 0.85rem;
    font-weight: 700;
    color: #B81C61;
  }

  .annonce-form-actions{
    margin-top: 18px;
    display: flex;
    justify-content: center;
  }

  .annonce-form-page button[type="submit"]{
    width: auto;
    border: 0;
    cursor: pointer;
    padding: 12px 18px;
    border-radius: 999px;
    font-weight: 800;
    font-family: "Montserrat Alternates", sans-serif;
    background: #fff;
    color: #000;
    border: 3px solid #000;
    box-shadow: 3px 6px 12px rgba(0,0,0,0.35);
  }

  .annonce-form-page button[type="submit"]:hover{
    background: #E40039;
  }

  .autre-type{ display: none; }
  .autre-type.is-visible{ display: block; }

  @media (max-width: 860px){
    .form-grid{ grid-template-columns: 1fr; }
    .form-grid--dates{ grid-template-columns: 1fr; }
    .annonce-form-body{ padding: 16px 14px 18px; }
  }

  @media (max-width: 900px) and (orientation: landscape){
    .annonce-form-page{ padding-top: 18px; }
  }
</style>

<div class="annonce-form-page"
     data-controller="annonce-form"
     data-annonce-form-autre-value="__autre__">
  <article class="annonce-form-card">
    <header class="annonce-form-header">
      <h1 class="annonce-form-title">Créer votre annonce</h1>
    </header>

    <div class="annonce-form-body">
      {{ form_start(form) }}

      <div class="form-grid">
        {{ form_row(form.titre, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'100'} }) }}
        {{ form_row(form.organisateur, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'100'} }) }}

        {{ form_row(form.type, {
          attr: {
            'data-action': 'change->annonce-form#toggleAutreType',
            'data-annonce-form-target': 'typeSelect limitField',
            'data-maxlength': '50'
          }
        }) }}

        <div class="autre-type {% if form.autreType.vars.data %}is-visible{% endif %}" data-annonce-form-target="autreTypeWrapper">
          {{ form_row(form.autreType, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'50'} }) }}
        </div>
      </div>

      <div class="form-grid form-block">
        {{ form_row(form.ville, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'50'} }) }}
        {{ form_row(form.departement, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'50'} }) }}
        {{ form_row(form.adresse, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'50'} }) }}
      </div>

      <div class="form-grid form-grid--dates form-block">
        {{ form_row(form.dateDebut, { attr: {'data-controller':'flatpickr'} }) }}
        {{ form_row(form.dateFin,   { attr: {'data-controller':'flatpickr'} }) }}
        {{ form_row(form.horaire,   { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'50'} }) }}
        {{ form_row(form.prix,      { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'50'} }) }}
      </div>

      <div class="form-block">
        {{ form_row(form.thumbnailFile) }}
      </div>

      {# TinyMCE : preview = CSS du show (richtext) #}
      <div
        class="form-block"
        data-controller="tinymce"
        data-tinymce-css-value="{{ absolute_url(asset('build/app.css')) }}"
        data-tinymce-body-class-value="richtext"
        data-tinymce-upload-url-value="{{ path('public.tinymce.upload') }}"
      >
        {{ form_row(form.presentation) }}
      </div>

      <div class="form-grid form-grid--1 form-block">
        {{ form_row(form.contact, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'100'} }) }}
      </div>

      
      {# IMPORTANT : on rend les champs cachés (CSRF, etc.), MAIS PAS le reste (donc pas de submit caché) #}
      {{ form_rest(form) }}
      <div class="annonce-form-actions">
        <button type="submit">Soumettre l’annonce</button>
      </div>
      {{ form_end(form, { render_rest: false }) }}
    </div>
  </article>
</div>
{% endblock %}
