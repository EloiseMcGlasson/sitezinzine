{% extends 'admin/admin.html.twig' %}
{% block title %}
  √âmission :
  {{ emission.titre }}
{% endblock %}
{% block body %}
  <style>
/* ‚úÖ Sp√©cifique admin : force full-width malgr√© le padding du layout */
.admin-fullbleed{
  width: 100vw;
  position: relative;
  left: 50%;
  right: 50%;
  margin-left: -50vw;
  margin-right: -50vw;
}

/* ========== G√âN√âRAL ========== */
.bodyemission,
.bodyemission *{
  box-sizing: border-box;
}

.bodyemission {
  background: linear-gradient(#E4013A, #B81C61);
  width: 100%;
  display: flex;
  flex-direction: column;
  font-family: "Montserrat Alternates", sans-serif;
  font-weight: 700;
  font-style: normal;
  position: relative;
  color: white;
  line-height: 1.5em;
  margin: 0 auto;
  padding: 0;
}

.bodyemission a,
.bodyemission .table-infos a {
  color: #E40039;
  font-weight: bold;
  text-decoration: none;
  transition: color 0.3s ease;
}

.bodyemission a:hover,
.bodyemission .table-infos a:hover {
  color: black;
}

.bodyemission .titre {
  text-align: center;
  margin: 10px;
}

.bodyemission .bottom img {
  width: 100%;
  display: block;
  margin-bottom: -1px;
}

/* ========== FICHE √âMISSION ========== */
.bodyemission .fiche-emission {
  max-width: 900px;
  width: calc(100% - 32px);
  margin: 2rem auto;
  background-color: #fff;
  color: #1C1C1A;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  padding: 1.5rem;
  font-family: "Montserrat Alternates", sans-serif;
}

.bodyemission .bloc-haut {
  display: flex;
  gap: 1.5rem;
  align-items: flex-start;
  flex-wrap: wrap;
}

.bodyemission .bloc-image img {
  width: 200px;
  border-radius: 6px;
  object-fit: cover;
  max-width: 100%;
  height: auto;
  display: block;
}

.bodyemission .bloc-texte {
  flex: 1;
  min-width: 0;
}

.bodyemission .bloc-texte h1 {
  font-size: 1.6rem;
  margin-bottom: 1rem;
  color: #E40039;
  overflow-wrap: anywhere;
}

.bodyemission .descriptif {
  font-size: 1rem;
  line-height: 1.6;
  margin: 15px;
  overflow-wrap: anywhere;
}

.bodyemission .btn-back {
  display: inline-block;
  margin-bottom: 1rem;
  color: #E40039;
  font-weight: bold;
  text-decoration: none;
}

.bodyemission .btn-back:hover {
  text-decoration: underline;
}

/* ‚úÖ Boutons admin dans la fiche (sans casser le style public) */
.bodyemission .admin-actions{
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 12px;
}

.bodyemission .admin-actions .btn-admin{
  display: inline-block;
  padding: 10px 14px;
  border-radius: 999px;
  background: #E40039;
  color: #fff;
  font-weight: 900;
  text-decoration: none;
}
.bodyemission .admin-actions .btn-admin:hover{
  background: #b30021;
  color: #fff;
}

/* ========== BLOC INFOS (TABLEAU) ========== */
.bodyemission .bloc-infos {
  margin-top: 2rem;
}

.bodyemission .table-infos {
  width: 100%;
  border-collapse: collapse;
  background-color: #f9f9f9;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.bodyemission .table-infos thead {
  border: 2px solid #E40039;
}

.bodyemission .table-infos th {
  background-color: #E40039;
  color: white;
  padding: 1rem;
  text-align: left;
  font-weight: bold;
  vertical-align: top;
  border-bottom: 2px solid #E40039;
}

.bodyemission .table-infos td {
  text-align: left;
  padding: 1rem;
  border-top: 1px solid #eee;
  border-bottom: 1px solid #eee;
  vertical-align: top;
  overflow-wrap: anywhere;
}

/* ========== CATEGORIE ========== */
.bodyemission .catemission {
  border: 2px solid black;
  overflow: hidden;
  border-radius: 8px;
  margin-top: 2rem;
  padding-bottom: 10px;
}

.bodyemission .catemission h1{
color: #E40039;
font-size: 1.6rem;
}

.bodyemission .catemission img {
  float: left;
  margin: 10px 20px 10px 10px;
  width: 250px;
  max-width: 100%;
  height: auto;
  display: block;
  border-radius: 8%;
}

/* ========== RESPONSIVE ========== */
@media (max-width: 768px) {
  .bodyemission .fiche-emission{
    width: calc(100% - 24px);
    padding: 1rem;
    margin: 1rem auto;
  }

  .bodyemission .bloc-haut {
    flex-direction: column;
    align-items: center;
  }

  .bodyemission .bloc-image img {
    width: min(320px, 100%);
  }

  .bodyemission .bloc-texte {
    text-align: center;
  }

  /* ‚úÖ TABLE ‚Üí en ‚Äúcards‚Äù */
  .bodyemission .table-infos thead{
    display: none;
  }

  .bodyemission .table-infos,
  .bodyemission .table-infos tbody,
  .bodyemission .table-infos tr,
  .bodyemission .table-infos td{
    display: block;
    width: 100%;
  }

  .bodyemission .table-infos tr{
    border: 2px solid #E40039;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 12px;
    background: #fff;
  }

  .bodyemission .table-infos td{
    border: none;
    border-top: 1px solid #eee;
    padding: 12px;
  }

  .bodyemission .table-infos td:first-child{
    border-top: none;
  }

  /* ‚úÖ CATEGORIE : on enl√®ve le float */
  .bodyemission .catemission{
    overflow: visible;
    text-align: center;
  }

  .bodyemission .catemission img{
    float: none;
    margin: 10px auto 14px;
    width: min(420px, 92%);
  }

  /* ‚úÖ CATEGORIE : descriptif plus lisible en mobile */
  .bodyemission .catemission .descriptif{
    margin: 12px 14px;
    text-align: left;
    font-size: 0.95rem;
    line-height: 1.55;
  }

  .bodyemission .bloc-texte .descriptif{
    text-align: left;
    font-size: 0.95rem;
    margin: 12px 0;
  }
}

/* Tr√®s petit */
@media (max-width: 420px){
  .bodyemission .bloc-texte h1{ font-size: 1.3rem; }
  .bodyemission .descriptif{ margin: 10px 0; }
}
</style>
  <div class="admin-fullbleed">
    <div class="bodyemission">
      <div class="fiche-emission">
        <a href="{{ app.request.headers.get('referer') ?? path('admin.emission.index') }}" class="btn-back">
          ‚Üê Retour
        </a>
        <div class="bloc-haut">
          <div class="bloc-image">
            {% if emission.thumbnail %}
              <img
              src="{{ vich_uploader_asset(emission, 'thumbnailFile') }}" alt="Photo de {{ emission.titre }}">
                {% elseif emission.categorie and emission.categorie.thumbnail %}
                <img
                src="{{ vich_uploader_asset(emission.categorie, 'thumbnailFile', 'App\\Entity\\Categories') }}" alt="Photo de {{ emission.titre }}">
                  {% elseif emission.theme is defined and emission.theme and emission.theme.thumbnail %}
                  <img
                  src="{{ vich_uploader_asset(emission.theme, 'thumbnailFile', 'App\\Entity\\Theme') }}" alt="Photo de {{ emission.titre }}">
                    {% else %}
                    <img src="/images/emission-zinzine.jpg" alt="Image par d√©faut">
                    {% endif %}
                  </div>
                  <div class="bloc-texte">
                    <h1>
                      {{ emission.titre }}
                    </h1>
                    <div class="descriptif">
                      {{ emission.descriptif | raw }}
                    </div>
                    {# ‚úÖ Actions admin (dans la carte, propre) #}
                    <div class="admin-actions">
                      <a class="btn-admin" href="{{ path('admin.emission.edit', { id: emission.id }) }}" data-controller="return" data-return-url-value="{{ path('admin.emission.edit', { id: emission.id }) }}" data-action="click->return#redirectWithReturnTo">
                        √âditer l‚Äô√©mission
                      </a>
                    </div>
                  </div>
                </div>
                <div class="bloc-infos">
                  <table class="table-infos">
                    <thead>
                      <tr>
                        <th>
                          Infos diverses
                        </th>
                        <th>
                          Horaire de passage
                        </th>
                        <th>
                          Liens
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>
                          <strong>
                            Th√®me :
                          </strong>
                          {{ emission.theme.name }}
                          <br>
                            <strong>
                              Animateur¬∑rice¬∑s :
                            </strong>
                            {% set usernames = emission.users|map(u => u.username)|join(', ') %}
                            {% set anciens = emission.inviteOldAnimateurs
                              |filter(a => a.ancienanimateur)
                              |map(a => a ~ '')
                              |join(', ') %}
                            {% if usernames %}
                              {{ usernames }}
                              {% if anciens %}
                                ,
                                {{ anciens }}
                              {% endif %}
                            {% elseif anciens %}
                              {{ anciens }}
                            {% else %}
                              Utilisateur inconnu
                            {% endif %}
                          </td>
                          <td>
                            {{ emission.datepub|format_datetime('long', 'none', locale='fr') }}
                          </td>
                          <td>
                            {% if emission.url %}
                              <a href="{{ emission.url }}" target="_blank">
                                üéß √âcouter
                              </a>
                              <br>
                                <a href="{{ emission.url }}" download target="_blank">
                                  ‚¨á T√©l√©charger
                                </a>
                              {% else %}
                                Aucun lien disponible
                              {% endif %}
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <div class="catemission">
                      <div class="titre">
                        {# si tu as une route admin.categorie.show, remplace le lien ici #}
                        <h1>
                          {{ emission.categorie.titre }}
                        </h1>
                      </div>
                      {% if emission.categorie.thumbnail %}
                        <img src="{{ vich_uploader_asset(emission.categorie, 'thumbnailFile', 'App\\Entity\\Categories') }}" alt="Photo de {{ emission.categorie.titre }}">
                        {% endif %}
                        <div class="descriptif">
                          {{ emission.categorie.descriptif | raw }}
                        </div>
                        <div class="admin-actions" style="justify-content:center; padding: 0 12px 14px;">
                          <a class="btn-admin" href="{{ path('admin.categorie.edit', { id: emission.categorie.id }) }}">
                            √âditer la cat√©gorie
                          </a>
                        </div>
                      </div>
                    </div>
                    <img class="bottom" src="/images/top-content-dechire-D.gif" alt="">
                      {% if emissions %}
                        <div class="emissionsdelacategorie">
                          {% include 'partials/_emission_results.html.twig' with {
      emissions: emissions,
      showNoResults: true,
      resultsTitle: 'Autres √©missions de cette cat√©gorie :',
      noResultsText: 'Aucune autre √©mission trouv√©e.',
      useKnpPagination: true,
      useLivePagination: false,
      searchTerm: null
    } only %}
                        </div>
                      {% endif %}
                    </div>
                  </div>
                {% endblock %}
                