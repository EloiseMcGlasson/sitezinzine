{% extends 'admin/admin.html.twig' %}

{% block title %}Éditer l'annonce {{ annonce.titre }}{% endblock %}

{% block body %}
<style>
  .annonce-form-page,
  .annonce-form-page *{ box-sizing: border-box; }

  .annonce-form-page{
    width: 100%;
    padding: 24px 16px 40px;
    font-family: "Montserrat Alternates", sans-serif;
  }

  .annonce-form-card{
    width: 100%;
    max-width: 980px;
    margin: 0 auto;
    background: #fff;
    color: #1C1C1A;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.10);
    overflow: hidden;
  }

  .annonce-form-header{
    padding: 18px 20px 12px;
    text-align: center;
    border-bottom: 1px solid #eee;
  }

  .annonce-form-title{
    margin: 0;
    font-weight: 900;
    font-size: clamp(18px, 3vw, 28px);
    color: #333;
  }

  .annonce-thumb{
    max-width: 520px;
    margin: 14px auto 0;
    padding: 0 16px;
  }
  .annonce-thumb img{
    width: 100%;
    height: auto;
    display: block;
    border-radius: 10px;
  }

  .annonce-form-body{
    padding: 18px 20px 22px;
  }

  .form-grid{
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px 16px;
  }
  .form-grid--1{ grid-template-columns: 1fr; }
  .form-grid--dates{ grid-template-columns: 1fr 1fr; }

  .form-block{ margin-top: 14px; }

  .annonce-form-page label{
    display: inline-block;
    margin-bottom: 6px;
    font-weight: 700;
    color: #333;
    font-size: 0.95rem;
  }

  .annonce-form-page input,
  .annonce-form-page select,
  .annonce-form-page textarea{
    width: 100%;
    padding: 12px 12px;
    border: 1px solid #ccc;
    border-radius: 8px;
    background: #fff;
    color: #1C1C1A;
    font-family: "Montserrat", sans-serif;
    font-size: 1rem;
  }

  .field-limit{
    margin-top: 6px;
    font-size: 0.85rem;
    font-weight: 700;
    color: #B81C61;
  }

  .annonce-form-actions{
    margin-top: 18px;
    display: flex;
    justify-content: center;
    gap: 12px;
  }

  .annonce-form-page button[type="submit"]{
    border: 0;
    cursor: pointer;
    padding: 10px 16px;
    border-radius: 10px;
    font-weight: 800;
    background: #111;
    color: #fff;
  }

  .annonce-form-page button[type="submit"]:hover{
    background: #E40039;
    color: #000;
  }

  .autre-type{ display: none; }
  .autre-type.is-visible{ display: block; }

  @media (max-width: 860px){
    .form-grid{ grid-template-columns: 1fr; }
    .form-grid--dates{ grid-template-columns: 1fr; }
    .annonce-form-body{ padding: 16px 14px 18px; }
  }
</style>

<div class="annonce-form-page" data-controller="annonce-form">
  <article class="annonce-form-card">
    <header class="annonce-form-header">
      <h1 class="annonce-form-title">Modifier : {{ annonce.titre }}</h1>

      {% if annonce.thumbnail %}
        <div class="annonce-thumb">
          <img src="{{ vich_uploader_asset(annonce, 'thumbnailFile') }}" alt="Photo de {{ annonce.titre }}">
        </div>
      {% endif %}
    </header>

    <div class="annonce-form-body">
      {{ form_start(form) }}

      <div class="form-grid">
        {{ form_row(form.titre, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'100'} }) }}
        {{ form_row(form.organisateur, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'100'} }) }}

        {# ✅ FIX : une seule clé data-annonce-form-target, avec les 2 targets #}
        {{ form_row(form.type, {
          attr: {
            'data-action': 'change->annonce-form#toggleAutreType',
            'data-annonce-form-target': 'typeSelect limitField',
            'data-maxlength': '50'
          }
        }) }}

        <div class="autre-type {% if form.autreType.vars.data %}is-visible{% endif %}"
             data-annonce-form-target="autreTypeWrapper">
          {{ form_row(form.autreType, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'50'} }) }}
        </div>
      </div>

      <div class="form-grid form-block">
        {{ form_row(form.ville, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'50'} }) }}
        {{ form_row(form.departement, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'50'} }) }}
        {{ form_row(form.adresse, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'50'} }) }}
      </div>

      <div class="form-grid form-grid--dates form-block">
        {{ form_row(form.dateDebut, { attr: {'data-controller':'flatpickr'} }) }}
        {{ form_row(form.dateFin,   { attr: {'data-controller':'flatpickr'} }) }}
        {{ form_row(form.horaire,   { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'50'} }) }}
        {{ form_row(form.prix,      { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'50'} }) }}
      </div>

      <div class="form-block"
           data-controller="tinymce"
           data-tinymce-css-value="{{ absolute_url(asset('build/editable.css')) }}"
           data-tinymce-richtext-css-value="{{ absolute_url(asset('build/annonce_show.css')) }}"
           data-tinymce-body-class-value="richtext"
           data-tinymce-upload-url-value="{{ path('admin.tinymce.upload') }}">
        {{ form_row(form.presentation) }}
      </div>

      <div class="form-grid form-grid--1 form-block">
        {{ form_row(form.contact, { attr: {'data-annonce-form-target':'limitField', 'data-maxlength':'100'} }) }}
      </div>

      {# ✅ Comme côté public : on rend les champs cachés (CSRF, etc.) #}
      {{ form_rest(form) }}

      <div class="annonce-form-actions">
        <button type="submit">Enregistrer</button>
      </div>

      {{ form_end(form, { render_rest: false }) }}
    </div>
  </article>
</div>
{% endblock %}
