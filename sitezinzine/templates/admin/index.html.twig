{% extends 'admin/admin.html.twig' %}

{% block title %}Administration - Radio Zinzine{% endblock %}

{% block body %}

<style>
/* ===== Admin Dashboard (scope) ===== */
.admin-dashboard {
  color: white;
  font-family: "Montserrat Alternates", sans-serif;
}

/* Le bloc "Bonjour + r√¥les + d√©connexion" */
.admin-dashboard .alert.alert-info {
  background: rgba(28, 28, 26, 0.55);
  border: 1px solid rgba(255,255,255,0.18);
  border-radius: 12px;
  padding: 16px;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

/* Bouton d√©connexion dans le header */
.admin-dashboard .alert a.btn.btn-danger {
  margin-left: auto;
  display: inline-flex;
  align-items: center;
  gap: .5rem;
  padding: .6rem 1rem;
  border-radius: 10px;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.18);
  color: #fff;
  text-decoration: none;
  font-weight: 700;
}

.admin-dashboard .alert a.btn.btn-danger:hover {
  background: rgba(255,255,255,0.14);
  border-color: rgba(255,255,255,0.28);
}

/* Badges r√¥les */
.admin-dashboard .badge.bg-primary {
  display: inline-block;
  padding: .25rem .6rem;
  border-radius: 999px;
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.18);
  color: #fff;
  font-weight: 700;
  margin-right: 6px;
}

/* Intro texte */
.admin-dashboard p {
  max-width: 900px;
  margin: 0 auto 10px auto;
  line-height: 1.6;
}
.admin-dashboard p a {
  color: #fff;
  text-decoration: underline;
  text-decoration-thickness: 2px;
  text-underline-offset: 3px;
}
.admin-dashboard p a:hover {
  color: #1C1C1A;
  background: #fff;
  text-decoration: none;
  padding: 0 .2rem;
  border-radius: 4px;
}

/* ===== Layout cards (sans Bootstrap) ===== */
.admin-dashboard .row.mt-4 {
  display: flex;
  gap: 16px;
  align-items: stretch;
  flex-wrap: wrap;
}

/* Colonnes */
.admin-dashboard .col-md-4 {
  flex: 1 1 260px;
  min-width: 260px;
}
.admin-dashboard .col-md-8 {
  flex: 2 1 520px;
  min-width: 320px;
}

/* Cartes */
.admin-dashboard .card {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.18);
  border-radius: 12px;
  box-shadow: 0 10px 24px rgba(0,0,0,0.18);
}

.admin-dashboard .card .card-body {
  padding: 16px;
}

/* Titres/texte de cartes */
.admin-dashboard .card-title {
  color: #fff;
  font-weight: 900;
  margin: 0 0 6px 0;
}
.admin-dashboard .card-text {
  margin: 0 0 12px 0;
  color: rgba(255,255,255,0.92);
}

/* Bouton "Acc√©der" */
.admin-dashboard a.btn.btn-primary {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: .65rem 1rem;
  border-radius: 10px;
  background: #fff;
  color: #1C1C1A;
  border: 1px solid rgba(0,0,0,0.15);
  text-decoration: none;
  font-weight: 800;
}
.admin-dashboard a.btn.btn-primary:hover {
  background: rgba(255,255,255,0.92);
}

/* ===== Changelog ===== */
.admin-dashboard .changelog-wrapper {
  max-width: none; /* on laisse la colonne g√©rer */
  margin: 0;
}

.admin-dashboard #changelog {
  max-height: 320px;
  overflow-y: auto;
  padding: 12px;
  background: rgba(28, 28, 26, 0.85);
  border: 1px solid rgba(255,255,255,0.16);
  border-radius: 10px;
  color: #fff;
  font-size: 0.95rem;
  line-height: 1.5;
}

/* Markdown rendu par marked */
.admin-dashboard #changelog h1,
.admin-dashboard #changelog h2,
.admin-dashboard #changelog h3 {
  color: #fff;
  font-size: 1.05rem;
  margin: 12px 0 8px 0;
  font-weight: 900;
}
.admin-dashboard #changelog a {
  color: #fff;
  text-decoration: underline;
  text-underline-offset: 3px;
}
.admin-dashboard #changelog ul {
  padding-left: 18px;
  margin: 0 0 10px 0;
}
.admin-dashboard #changelog strong {
  font-weight: 800;
}

/* Scrollbar (optionnel) */
.admin-dashboard #changelog::-webkit-scrollbar {
  width: 8px;
}
.admin-dashboard #changelog::-webkit-scrollbar-thumb {
  background-color: rgba(255,255,255,0.35);
  border-radius: 999px;
}
.admin-dashboard #changelog::-webkit-scrollbar-thumb:hover {
  background-color: rgba(255,255,255,0.5);
}

/* ===== Bloc "changer de r√¥le" (ton bloc hors card) ===== */
.admin-dashboard .card-body {
  color: white;
}

.admin-dashboard .admin-switch-user {
  margin-top: 16px;
}

.admin-dashboard .switch-user-link {
  display: inline-flex;
  align-items: center;
  padding: .35rem .65rem;
  border-radius: 999px;
  background: rgba(255,255,255,0.10);
  border: 1px solid rgba(255,255,255,0.18);
  color: #fff;
  text-decoration: none;
  font-weight: 700;
  margin: 6px 6px 0 0;
}

.admin-dashboard .switch-user-link:hover {
  background: rgba(255,255,255,0.16);
  border-color: rgba(255,255,255,0.28);
}

.admin-dashboard .impersonation {
  margin-top: 10px;
  padding: 10px 12px;
  border-radius: 10px;
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(255,255,255,0.16);
}

.admin-dashboard .switch-user-exit {
  margin-left: 10px;
  color: #fff;
  text-decoration: underline;
  text-underline-offset: 3px;
  font-weight: 800;
}

.admin-switch-user {
  margin-top: 16px;
}

.switch-user-form {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.switch-user-form label {
  color: white;
  font-weight: 600;
}

.switch-user-select {
  padding: 10px 14px;
  border-radius: 12px;
  border: 2px solid rgba(255,255,255,0.25);
  background: rgba(255,255,255,0.95);
  font-family: "Montserrat Alternates", sans-serif;
  font-size: 1rem;
  cursor: pointer;
}

.switch-user-select:focus {
  outline: none;
  border-color: #E40039;
}

.impersonation {
  margin-top: 12px;
  padding: 10px 12px;
  border-radius: 10px;
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(255,255,255,0.16);
  color: white;
}

.switch-user-exit {
  margin-left: 10px;
  color: #fff;
  font-weight: 800;
  text-decoration: underline;
  text-underline-offset: 3px;
}




/* ===== Responsive ===== */
@media (max-width: 900px) {
  .admin-dashboard .alert a.btn.btn-danger {
    margin-left: 0;
  }
}


</style>



<div class="admin-dashboard container mt-4">
    <div class="alert alert-info">
        Bonjour {{ user.username ?? 'utilisateur' }} !
        <a href="{{ path('app_logout') }}" class="btn btn-danger">
            <i class="fas fa-sign-out-alt"></i> D√©connexion
        </a>
        <div class="mt-2">
            Vos r√¥les :
            {% for role in user.roles %}
                <span class="badge bg-primary">
                    {{ role|replace({'ROLE_': ''}) |title }}
                </span>
            {% endfor %}
        </div>
    </div>

    <h1>Tableau de bord</h1>
        <p>Bienvenue dans l'interface d'administration de Radio Zinzine
        Ce site est une d√©mo et est mis √† jour r√©guli√®rement, les avanc√©es sont indiqu√©es dans le changelog.</p>
        <p>Pour toute question, suggestion ou correction, n'h√©sitez pas √† me contacter <a href="mailto:drelin04@hotmail.fr">par mail</a> ou sur signal.</p>


    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">√âmissions</h5>
                    <p class="card-text">G√©rer les √©missions</p>
                    <a href="{{ path('admin.emission.index') }}" class="btn btn-primary">Acc√©der</a>
                </div>
            </div>
        </div>

        <!-- Ajout du bloc changelog -->
<div class="col-md-8">
    <div class="card changelog-wrapper">
        <div class="card-body">
           
            <div id="changelog">
                <p>Chargement du changelog...</p>
            </div>
        </div>
    </div>
</div>

        
        {% if is_granted('ROLE_SUPER_ADMIN') or is_granted('ROLE_PREVIOUS_ADMIN') %}
  <div class="col-12">
    <div class="card admin-switch-user">
      <div class="card-body">
        <h5 class="card-title">Changer de r√¥le</h5>

        <form method="get" class="switch-user-form">
          <label for="switch-user-select">Se connecter en tant que :</label>

          <select
            id="switch-user-select"
            class="switch-user-select"
            name="_switch_user"
            onchange="this.form.submit()"
          >
            <option value="">‚Äî S√©lectionner un utilisateur ‚Äî</option>

            {% for u in users %}
              <option value="{{ u.username }}">
                {{ u.username }}
              </option>
            {% endfor %}
          </select>
        </form>

        {% if is_granted('ROLE_PREVIOUS_ADMIN') %}
          <p class="impersonation">
            Tu es en impersonation üé≠
            <a class="switch-user-exit" href="?_switch_user=_exit">
              Revenir √† mon compte
            </a>
          </p>
        {% endif %}
      </div>
    </div>
  </div>
{% endif %}


    </div>
</div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <!-- Ajoute ton script pour charger le changelog -->
    <script src="https://cdn.jsdelivr.net/npm/marked@3.0.0/lib/marked.min.js"></script>

    <defer>
    <script>
        // Fonction pour r√©cup√©rer le fichier markdown et l'afficher dans l'encart
        fetch('{{ asset('changelog.md') }}')  // Remplace par le chemin vers ton fichier changelog.md
            .then(response => response.text())  // Lire le contenu du fichier .md
            .then(markdownText => {
                // Convertir le markdown en HTML
                const htmlContent = marked(markdownText);
                // Ins√©rer le contenu dans le div avec l'id changelog
                document.getElementById('changelog').innerHTML = htmlContent;
            })
            .catch(err => {
                console.error('Erreur lors du chargement du changelog:', err);
                document.getElementById('changelog').innerHTML = '<p>Impossible de charger le changelog.</p>';
            });
    </script>
{% endblock %}
